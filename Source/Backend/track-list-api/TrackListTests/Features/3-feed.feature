# –ú–æ–≤–∞: uk
@epic3 @feed
–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª: –°—Ç—Ä—ñ—á–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
  –Ø–∫ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á,
  –Ø —Ö–æ—á—É –±–∞—á–∏—Ç–∏ –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Å—Ç—Ä—ñ—á–∫—É —Ä–µ—Ü–µ–Ω–∑—ñ–π –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –Ω–∞ —è–∫–∏—Ö —è –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π,
  –ê —Ç–∞–∫–æ–∂ –º–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∑–∞—î–º–æ–¥—ñ—è—Ç–∏ –∑ —Ü–∏–º–∏ —Ä–µ—Ü–µ–Ω–∑—ñ—è–º–∏ (–ª–∞–π–∫–∞—Ç–∏, –±–∞—á–∏—Ç–∏ —Ç–æ–ø-–∫–æ–º–µ–Ω—Ç–∞—Ä)
  –©–æ–± —à–≤–∏–¥–∫–æ —Ä–µ–∞–≥—É–≤–∞—Ç–∏ –Ω–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –º–æ—ó—Ö –ø—ñ–¥–ø–∏—Å–æ–∫.

  –ü–µ—Ä–µ–¥—É–º–æ–≤–∞:
    –î–∞–Ω–æ –í –±–∞–∑—ñ –¥–∞–Ω–∏—Ö —ñ—Å–Ω—É—é—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ "user", "following_1", "following_2" —Ç–∞ "other_user"
    –Ü –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á "user" –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π –≤ —Å–∏—Å—Ç–µ–º—ñ
    # –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–≤'—è–∑–∫–∏ –ø—ñ–¥–ø–∏—Å–æ–∫ (—è–∫—ñ –Ω–µ "soft-deleted")
    –Ü "user" –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π –Ω–∞ "following_1"
    –Ü "user" –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π –Ω–∞ "following_2"
    –Ü "user" –ù–ï –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π –Ω–∞ "other_user"
    # –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–Ω—Ç–µ–Ω—Ç (—Ä–µ—Ü–µ–Ω–∑—ñ—ó, —è–∫—ñ –Ω–µ "soft-deleted")
    –Ü "following_1" –Ω–∞–ø–∏—Å–∞–≤ —Ä–µ—Ü–µ–Ω–∑—ñ—é "review_1" –Ω–∞ "–ú–µ–¥—ñ–∞ –ê" (5 –≥–æ–¥–∏–Ω —Ç–æ–º—É)
    –Ü "review_1" –º–∞—î "15" –≤–ø–æ–¥–æ–±–∞–π–æ–∫
    –Ü "following_2" –Ω–∞–ø–∏—Å–∞–≤ —Ä–µ—Ü–µ–Ω–∑—ñ—é "review_2" –Ω–∞ "–ú–µ–¥—ñ–∞ –ë" (2 –≥–æ–¥–∏–Ω–∏ —Ç–æ–º—É)
    –Ü "other_user" –Ω–∞–ø–∏—Å–∞–≤ —Ä–µ—Ü–µ–Ω–∑—ñ—é "review_3" –Ω–∞ "–ú–µ–¥—ñ–∞ –í" (1 –≥–æ–¥–∏–Ω—É —Ç–æ–º—É)
    # –°—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ –¥–æ "review_1"
    –Ü "other_user" –∑–∞–ª–∏—à–∏–≤ –∫–æ–º–µ–Ω—Ç–∞—Ä "comment_A" (–¥–æ "review_1") –∑ "5" –ª–∞–π–∫–∞–º–∏
    –Ü "user" –∑–∞–ª–∏—à–∏–≤ –∫–æ–º–µ–Ω—Ç–∞—Ä "comment_B" (–¥–æ "review_1") –∑ "2" –ª–∞–π–∫–∞–º–∏

  @us-301 @happy-path
  –°—Ü–µ–Ω–∞—Ä—ñ–π: –ü–µ—Ä–µ–≥–ª—è–¥ –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ—ó —Å—Ç—Ä—ñ—á–∫–∏
    –ö–æ–ª–∏ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á "user" –≤—ñ–¥–∫—Ä–∏–≤–∞—î –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É ("/")
    –¢–æ–¥—ñ –í—ñ–Ω –±–∞—á–∏—Ç—å "review_2" (–≤—ñ–¥ "following_2")
    –Ü –í—ñ–Ω –±–∞—á–∏—Ç—å "review_1" (–≤—ñ–¥ "following_1")
    –Ü "review_2" –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —É —Å—Ç—Ä—ñ—á—Ü—ñ –≤–∏—â–µ, –Ω—ñ–∂ "review_1" # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ö—Ä–æ–Ω–æ–ª–æ–≥—ñ—á–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫—É
    –Ü –í—ñ–Ω –ù–ï –±–∞—á–∏—Ç—å "review_3" (–≤—ñ–¥ "other_user")

  @us-301 @negative-path
  –°—Ü–µ–Ω–∞—Ä—ñ–π: –ü–µ—Ä–µ–≥–ª—è–¥ –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ—ó —Å—Ç—Ä—ñ—á–∫–∏ (–±–µ–∑ –ø—ñ–¥–ø–∏—Å–æ–∫)
    –î–∞–Ω–æ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á "new_user" –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π –≤ —Å–∏—Å—Ç–µ–º—ñ
    –Ü "new_user" —â–µ –Ω—ñ –Ω–∞ –∫–æ–≥–æ –Ω–µ –ø—ñ–¥–ø–∏—Å–∞–Ω–∏–π
    –ö–æ–ª–∏ "new_user" –≤—ñ–¥–∫—Ä–∏–≤–∞—î –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É ("/")
    –¢–æ–¥—ñ –í—ñ–Ω –ù–ï –±–∞—á–∏—Ç—å –∂–æ–¥–Ω–æ—ó —Ä–µ—Ü–µ–Ω–∑—ñ—ó
    –Ü –í—ñ–Ω –±–∞—á–∏—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è "–í–∞—à–∞ —Å—Ç—Ä—ñ—á–∫–∞ –ø–æ—Ä–æ–∂–Ω—è. –ü—ñ–¥–ø–∏—à—ñ—Ç—å—Å—è –Ω–∞ –∫–æ–≥–æ—Å—å –∞–±–æ –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –ì–ª–æ–±–∞–ª—å–Ω—É —Å—Ç—Ä—ñ—á–∫—É."

  @us-302 @happy-path
  –°—Ü–µ–Ω–∞—Ä—ñ–π: –ü–µ—Ä–µ–≥–ª—è–¥ –ì–ª–æ–±–∞–ª—å–Ω–æ—ó —Å—Ç—Ä—ñ—á–∫–∏
    –î–∞–Ω–æ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á "user" –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π –≤ —Å–∏—Å—Ç–µ–º—ñ
    –ö–æ–ª–∏ "user" –≤—ñ–¥–∫—Ä–∏–≤–∞—î –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É ("/")
    –Ü "user" –Ω–∞—Ç–∏—Å–∫–∞—î –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ì–ª–æ–±–∞–ª—å–Ω–∞ —Å—Ç—Ä—ñ—á–∫–∞"
    –¢–æ–¥—ñ –í—ñ–Ω –±–∞—á–∏—Ç—å "review_3" (–≤—ñ–¥ "other_user")
    –Ü –í—ñ–Ω –±–∞—á–∏—Ç—å "review_2" (–≤—ñ–¥ "following_2")
    –Ü –í—ñ–Ω –±–∞—á–∏—Ç—å "review_1" (–≤—ñ–¥ "following_1")
    –Ü "review_3" –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —É —Å—Ç—Ä—ñ—á—Ü—ñ –≤–∏—â–µ # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ö—Ä–æ–Ω–æ–ª–æ–≥—ñ—á–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫—É

  @us-303 @happy-path
  –°—Ü–µ–Ω–∞—Ä—ñ–π: –í–ø–æ–¥–æ–±–∞–π–∫–∞ —Ä–µ—Ü–µ–Ω–∑—ñ—ó –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∑—ñ —Å—Ç—Ä—ñ—á–∫–∏
    –î–∞–Ω–æ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á "user" –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π —ñ –±–∞—á–∏—Ç—å "review_1" —É —Å–≤–æ—ó–π —Å—Ç—Ä—ñ—á—Ü—ñ
    –Ü "review_1" –º–∞—î "15" –≤–ø–æ–¥–æ–±–∞–π–æ–∫
    –Ü "user" —â–µ –Ω–µ –ª–∞–π–∫–Ω—É–≤ "review_1"
    –ö–æ–ª–∏ –í—ñ–Ω –Ω–∞—Ç–∏—Å–∫–∞—î "–í–ø–æ–¥–æ–±–∞—Ç–∏" (Like) –Ω–∞ "review_1" —É —Å—Ç—Ä—ñ—á—Ü—ñ
    –¢–æ–¥—ñ –õ—ñ—á–∏–ª—å–Ω–∏–∫ –≤–ø–æ–¥–æ–±–∞–π–æ–∫ "review_1" –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –Ω–∞ "16" (—É —Å—Ç—Ä—ñ—á—Ü—ñ)
    –Ü –ö–Ω–æ–ø–∫–∞ –∑–º—ñ–Ω—é—î —Å—Ç–∞–Ω –Ω–∞ "–í–ø–æ–¥–æ–±–∞–Ω–æ" (Liked)
    –Ü –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ "/" (–±–µ–∑ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è)

  @us-304 @happy-path
  –°—Ü–µ–Ω–∞—Ä—ñ–π: –ü–µ—Ä–µ–≥–ª—è–¥ –Ω–∞–π–∑–∞–ª–∞–π–∫–∞–Ω—ñ—à–æ–≥–æ –∫–æ–º–µ–Ω—Ç–∞—Ä—è —É —Å—Ç—Ä—ñ—á—Ü—ñ
    –î–∞–Ω–æ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á "user" –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π —ñ –±–∞—á–∏—Ç—å "review_1" —É —Å–≤–æ—ó–π —Å—Ç—Ä—ñ—á—Ü—ñ
    –ö–æ–ª–∏ –í—ñ–Ω –¥–∏–≤–∏—Ç—å—Å—è –Ω–∞ –±–ª–æ–∫ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ –ø—ñ–¥ "review_1"
    –¢–æ–¥—ñ –í—ñ–Ω –±–∞—á–∏—Ç—å "comment_A" (–≤—ñ–¥ "other_user")
    –Ü –í—ñ–Ω –±–∞—á–∏—Ç—å –ª—ñ—á–∏–ª—å–Ω–∏–∫ "5" –≤–ø–æ–¥–æ–±–∞–π–æ–∫ –±—ñ–ª—è "comment_A"
    –Ü –í—ñ–Ω –ù–ï –±–∞—á–∏—Ç—å "comment_B" (—è–∫–∏–π –º–∞—î –º–µ–Ω—à–µ –ª–∞–π–∫—ñ–≤)
    –Ü –í—ñ–Ω –±–∞—á–∏—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è "–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ N –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤..."

# ---
# 
# üõ†Ô∏è –ó–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è Backend (.Net / EF / Postgres)
#
# 1.  **BaseEntity (–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è):**
#     * –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ `Follows`, `Reviews`, `ReviewLikes`, `Comments` —É—Å–ø–∞–¥–∫–æ–≤—É—é—Ç—å `BaseEntity` (–∑ `DeletedAt`).
#     * –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ **Global Query Filter** (`.Where(e => e.DeletedAt == null)`) –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –¥–ª—è *–≤—Å—ñ—Ö* —Ü–∏—Ö —Å—É—Ç–Ω–æ—Å—Ç–µ–π.
#
# 2.  **API –ï–Ω–¥–ø–æ—ñ–Ω—Ç: `GET /api/feed/personal` (US-301, 303, 304)**
#     * –¶–µ **–Ω–∞–π—Å–∫–ª–∞–¥–Ω—ñ—à–∏–π –∑–∞–ø–∏—Ç** —É –ø—Ä–æ—î–∫—Ç—ñ. –í—ñ–Ω –≤–∏–º–∞–≥–∞—Ç–∏–º–µ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó (LIMIT/OFFSET).
#     * **–õ–æ–≥—ñ–∫–∞ –∑–∞–ø–∏—Ç—É:**
#         * 1. `SELECT r.* FROM Reviews r`
#         * 2. `JOIN Follows f ON f.FollowingId = r.UserId` (–ü—Ä–∏—î–¥–Ω–∞—Ç–∏ –ø—ñ–¥–ø–∏—Å–∫–∏)
#         * 3. `WHERE f.FollowerId = {current_user_id}` (–§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –∑–∞ –ø–æ—Ç–æ—á–Ω–∏–º —é–∑–µ—Ä–æ–º)
#         * 4. (Global Query Filter –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ–¥–∞—Å—Ç—å `AND f.DeletedAt IS NULL AND r.DeletedAt IS NULL`)
#         * 5. **(–î–ª—è US-303)** `LEFT JOIN ReviewLikes rl ON rl.ReviewId = r.Id AND rl.UserId = {current_user_id}` (–©–æ–± –∑–Ω–∞—Ç–∏, —á–∏ –ª–∞–π–∫–Ω—É–≤ *—Ü–µ–π* —é–∑–µ—Ä)
#         * 6. **(–î–ª—è US-304)** `CROSS APPLY (SELECT TOP 1 c.*, COUNT(cl.Id) as LikeCount ... FROM Comments c LEFT JOIN CommentLikes cl ... WHERE c.ReviewId = r.Id ... GROUP BY c.Id ORDER BY LikeCount DESC)` (–ê–±–æ `LATERAL JOIN` –≤ Postgres, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ 1 —Ç–æ–ø-–∫–æ–º–µ–Ω—Ç–∞—Ä).
#         * 7. `ORDER BY r.CreatedAt DESC`
#         * 8. `LIMIT 20 OFFSET {page * 20}`
#     * **–ü–æ–≤–µ—Ä—Ç–∞—Ç–∏ DTO:** `ReviewDto` –º–∞—î –≤–∫–ª—é—á–∞—Ç–∏ `isLikedByMe: bool` —Ç–∞ `topComment: CommentDto?`.
#
# 3.  **API –ï–Ω–¥–ø–æ—ñ–Ω—Ç: `GET /api/feed/global` (US-302)**
#     * –ù–∞–±–∞–≥–∞—Ç–æ –ø—Ä–æ—Å—Ç—ñ—à–∏–π. –ü—Ä–æ—Å—Ç–æ `SELECT` –∑ `Reviews` (–∑ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—î—é —Ç–∞ `JOIN`-–∞–º–∏ –¥–ª—è `isLikedByMe` —Ç–∞ `topComment`), –∞–ª–µ –±–µ–∑ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –ø–æ `Follows`.
#
# ---
#
# üé® –ó–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è Frontend (Svelte-kit)
#
# 1.  **–ú–∞—Ä—à—Ä—É—Ç: `src/routes/+page.svelte` (–ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞)**
#     * –ú–∞—î —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ "Infinite Scroll" (–Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω—É –ø—Ä–æ–∫—Ä—É—Ç–∫—É) –∞–±–æ –ø–∞–≥—ñ–Ω–∞—Ü—ñ—é, —è–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î `GET /api/feed/personal?page=...`.
#     * –ú–∞—î –º–∞—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç "–≤–∫–ª–∞–¥–æ–∫" (Tabs) –¥–ª—è –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º—ñ–∂ "–ú–æ—è —Å—Ç—Ä—ñ—á–∫–∞" (`/api/feed/personal`) —Ç–∞ "–ì–ª–æ–±–∞–ª—å–Ω–∞ —Å—Ç—Ä—ñ—á–∫–∞" (`/api/feed/global`).
#     * –ú–∞—î –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –∑–∞–≥–ª—É—à–∫—É, —è–∫—â–æ `data.length === 0` (–°—Ü–µ–Ω–∞—Ä—ñ–π `US-301 @negative-path`).
#
# 2.  **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç: `ReviewCard.svelte` (–ö–∞—Ä—Ç–æ—á–∫–∞ —Ä–µ—Ü–µ–Ω–∑—ñ—ó —É —Å—Ç—Ä—ñ—á—Ü—ñ)**
#     * –ú–∞—î –±—É—Ç–∏ "stateful" (—Ä–æ–∑—É–º–Ω–∏–π).
#     * **Props:** `export let review: ReviewDto;` (–¥–µ `review` –º—ñ—Å—Ç–∏—Ç—å `isLikedByMe` —Ç–∞ `topComment`).
#     * **–õ–æ–≥—ñ–∫–∞ –õ–∞–π–∫—ñ–≤ (US-303):**
#         * –ö–Ω–æ–ø–∫–∞ "–í–ø–æ–¥–æ–±–∞—Ç–∏" –±–µ—Ä–µ —Å–≤—ñ–π –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω –∑ `review.isLikedByMe`.
#         * –ü—Ä–∏ –∫–ª—ñ–∫—É -> *–æ–ø—Ç–∏–º—ñ—Å—Ç–∏—á–Ω–æ* (–æ–¥—Ä–∞–∑—É) –æ–Ω–æ–≤–ª—é—î UI (–ª—ñ—á–∏–ª—å–Ω–∏–∫ —Ç–∞ —Å—Ç–∞–Ω –∫–Ω–æ–ø–∫–∏) —ñ *–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ* –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î `POST /api/reviews/{review.id}/like` (–∞–±–æ `DELETE`).
#     * **–õ–æ–≥—ñ–∫–∞ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ (US-304):**
#         * –†–µ–Ω–¥–µ—Ä–∏—Ç—å `topComment`, —è–∫—â–æ `review.topComment` –Ω–µ `null`.
#         * –†–µ–Ω–¥–µ—Ä–∏—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è `<a>` "–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ N –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤...", —è–∫–µ –≤–µ–¥–µ –Ω–∞ `/media/{review.mediaId}?reviewId={review.id}` (–¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –¥–æ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤).
#