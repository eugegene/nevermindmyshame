# Мова: uk
@epic4 @media
Функціонал: Сторінка медіа-контенту та взаємодія
  Як Користувач (або Гість),
  Я хочу переглядати детальну інформацію про медіа-контент моєю мовою
  Та пропонувати власні переклади, якщо офіційні відсутні або невірні.

Передумова:
    Дано Існує медіа "Dune" (Id: 2)
    І Існує медіа "Inception" (Id: 3)
    І В `MediaTranslations` існує: (MediaId: 2, Lang: "en", Title: "Dune", Description: "English desc...")
    І В `MediaTranslations` існує: (MediaId: 2, Lang: "uk", Title: "Дюна", Description: "Український опис...")
    І В `MediaTranslations` існує: (MediaId: 3, Lang: "en", Title: "Inception")
    І В базі даних існує користувач "user"
    І В базі даних існує користувач "other_user"
    # [ЗМІНЕНО] Тепер рецензія прив'язана до "Dune (Id: 2)", а не до "Фільм А"
    І "other_user" написав рецензію "review_1" на "Dune" (Id: 2)
    І "other_user" написав коментар "comment_1" до рецензії "review_1"
    І Користувач "user" авторизований
    І Мова інтерфейсу користувача "user" встановлена на "uk"

# --- US-401: Перегляд сторінки медіа ---

  @us-401 @happy-path
  Сценарій: Користувач бачить сторінку медіа мовою свого інтерфейсу
    Коли Користувач "user" відкриває сторінку "/media/2" (Dune)
    Тоді Він бачить заголовок "Дюна"
    І Він бачить опис "Український опис..."
    І Він бачить рейтинги IMdB / Rotten Tomatoes
    І Він бачить список рецензій, включаючи "review_1"

  @us-401 @happy-path
  Сценарій: Користувач бачить сторінку (дефолтна мова), якщо його мова відсутня
    Дано Мова інтерфейсу користувача "user" встановлена на "pl" (Польська)
    І Для "Dune" (Id: 2) не існує перекладу "pl"
    Коли Користувач "user" відкриває сторінку "/media/2" (Dune)
    # Бекенд не знаходить 'pl' і повертає 'en' як дефолтну
    Тоді Він бачить заголовок "Dune"
    І Він бачить опис "English desc..."

# --- US-402: Створення/Редагування Рецензії ---

  @us-402 @happy-path @rich-text
  Сценарій: Користувач пише нову рецензію з rich-text
    Дано Користувач "user" авторизований і знаходиться на "/media/2" (Dune)
    І "user" ще не писав рецензію на "Dune" (Id: 2) (згідно з BRL-4)
    Коли Він ставить оцінку "5 зірок"
    І Він вводить в "rich-text" редактор текст: "Це **чудовий** фільм!"
    І Він натискає кнопку "Опублікувати рецензію"
    Тоді Система зберігає нову рецензію з HTML/Markdown ("<p>Це <strong>чудовий</strong> фільм!</p>")
    І Його рецензія з'являється у списку рецензій на сторінці
    І Він бачить повідомлення "Рецензію опубліковано"

  @us-402 @negative-path @brl-4
  Сценарій: Користувач намагається написати другу рецензію
    Дано Користувач "user" авторизований і знаходиться на "/media/2" (Dune)
    І "user" вже писав рецензію на "Dune" (Id: 2)
    Тоді Він бачить свою вже існуючу рецензію
    І Він бачить кнопку "Редагувати"
    І Він НЕ бачить форми для створення нової рецензії

# --- US-403: Вподобайки (Likes) ---

  @us-403 @happy-path
  Сценарій: Користувач лайкає рецензію
    Дано Користувач "user" авторизований і знаходиться на "/media/2" (Dune)
    І "user" ще не лайкнув "review_1"
    І "review_1" має "10" вподобайок
    Коли Він натискає "Вподобати" (Like) на "review_1"
    Тоді Лічильник вподобайок "review_1" стає "11"
    І Кнопка змінює стан на "Вподобано" (Liked)

  @us-403 @happy-path
  Сценарій: Користувач знімає вподобайку (Unlike)
    Дано Користувач "user" авторизований і знаходиться на "/media/2" (Dune)
    І "user" вже лайкнув "review_1"
    І "review_1" має "11" вподобайок
    Коли Він натискає "Вподобано" (Liked) на "review_1"
    Тоді Лічильник вподобайок "review_1" стає "10"
    І Кнопка змінює стан на "Вподобати" (Like)

# --- US-404: Коментарі (Рівень 0) ---

  @us-404 @happy-path
  Сценарій: Користувач пише новий коментар до рецензії (Рівень 0)
    # [ЗМІНЕНО] Тепер посилається на конкретний ID
    Дано Користувач "user" авторизований і знаходиться на "/media/2" (Dune)
    Коли Він вводить "Мій коментар рівня 0" у поле коментування під "review_1"
    І Він натискає "Відправити"
    Тоді "Мій коментар рівня 0" з'являється у списку коментарів під "review_1"

# --- US-405: Відповіді на коментарі (Рівень 1) ---
# [ЗМІН НЕМАЄ] - Цей блок логічний і не посилався на ID сторінки

  @us-405 @happy-path
  Сценарій: Користувач відповідає на коментар (Рівень 1)
    Дано Користувач "user" авторизований і бачить "comment_1" (від "other_user")
    Коли Він натискає "Відповісти" біля "comment_1"
    І Він вводить "Моя відповідь рівня 1"
    І Він натискає "Відправити"
    Тоді "Моя відповідь рівня 1" з'являється під "comment_1" (з візуальним відступом)

# --- US-406: Обмеження тредів (Немає Рівня 2) ---
# [ЗМІН НЕМАЄ] - Цей блок логічний

  @us-406 @happy-path
  Сценарій: Користувач не може відповісти на відповідь (Немає Рівня 2)
    Дано Користувач "user" авторизований
    І Існує "reply_1" (відповідь Рівня 1) на "comment_1"
    Коли Користувач "user" дивиться на "reply_1"
    Тоді Він НЕ бачить кнопку "Відповісти" біля "reply_1"
    І Він бачить кнопку "Відповісти" тільки біля "comment_1" (Рівень 0)

# --- US-407: Взаємодія для Гостей (Негативний сценарій) ---

  @us-407 @negative-path
  Сценарій: Гість намагається взаємодіяти з рецензією
    Дано Гість (неавторизований) знаходиться на "/media/2" (Dune)
    Коли Гість натискає "Вподобати" на "review_1"
    Тоді Його перенаправляє на сторінку "/login"
    І Система показує повідомлення "Ви повинні увійти, щоб виконати цю дію"

  @us-407 @negative-path
  Сценарій: Гість намагається написати коментар
    Дано Гість (неавторизований) знаходиться на "/media/2" (Dune)
    Коли Гість намагається ввести текст у поле коментування під "review_1"
    Тоді Поле коментування неактивне (або при кліку перенаправляє на "/login")
    І Він бачить повідомлення "Увійдіть, щоб залишати коментарі"

# --- US-408: Пропозиція перекладу від користувача ---
# [ЗМІН НЕМАЄ] - Цей блок був написаний коректно і логічно

  @us-408 @happy-path
  Сценарій: Користувач пропонує відсутній переклад
    Дано Користувач "user" знаходиться на сторінці "/media/3" (Inception)
    І Для "Inception" (Id: 3) відсутній український переклад
    Коли Він натискає кнопку "Запропонувати переклад"
    І Він обирає мову "Українська"
    І Він вводить "Назва": "Початок"
    І Він вводить "Опис": "Фільм про сни..."
    І Він натискає "Надіслати на модерацію"
    Тоді Система створює запис у `MediaTranslations` (MediaId: 3, Lang: "uk", Title: "Початок", Status: "Pending")
    І Він бачить повідомлення "Дякуємо, ваш переклад відправлено на модерацію"

  @us-408 @negative-path
  Сценарій: Користувач намагається запропонувати переклад, який вже існує
    Дано Користувач "user" знаходиться на сторінці "/media/2" (Dune)
    І Для "Dune" (Id: 2) вже існує схвалений переклад "Дюна" (Lang: "uk")
    Тоді Він НЕ бачить кнопки "Запропонувати переклад" для мови "Українська"
    # Натомість, він може поскаржитись на існуючий переклад

#Backend (.Net):

#Нам знадобляться нові таблиці: ReviewLikes (UserId, ReviewId) та Comments (Id, Content, ReviewId, UserId, ParentCommentId).

#ParentCommentId — це ключ до тредів. Якщо ParentCommentId == null, це коментар Рівня 0. Якщо він вказує на інший Id, це Рівень 1.

#Бекенд повинен імплементувати бізнес-логіку, яка забороняє ParentCommentId вказувати на коментар, який вже є Рівнем 1.

#Ендпоінт GET /api/media/{id}/reviews тепер має повертати рецензії, а також кількість лайків та коментарів для кожної.

#Frontend (Svelte-kit):

#Компонент Review.svelte стане складнішим. Він має керувати станом "вподобайки" (чи лайкнув цей юзер).

#Компонент CommentThread.svelte має завантажувати коментарі. Він повинен рекурсивно відображати відповіді, але лише до 1-го рівня вкладеності (згідно з US-406, кнопка "Відповісти" буде лише біля коментарів 0-го рівня).

#Потрібен хороший Rich-text редактор (наприклад, TipTap або Quill).